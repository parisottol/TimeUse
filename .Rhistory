rename(
., c("Male" = `1`,  "Female" = `2`)
) %>%
select(-total)
check <- df %>%
select(YEAR,SEX) %>%
group_by(YEAR,SEX) %>%
filter(SEX!=-8) %>%
count(YEAR) %>%
mutate(
total=sum(.$n)
) %>%
spread(
.,SEX,n
) %>%
rename(
., c("Male" = `1`,  "Female" = `2`)
) %>%
select(-total)
print(check , n=27)
check <- df %>%
select(YEAR,SEX) %>%
group_by(YEAR,SEX) %>%
filter(SEX!=-8) %>%
count(YEAR) %>%
mutate(
total=sum(.$n)
) %>%
spread(
.,SEX,n
) %>%
rename(
., c("Male" = `1`,  "Female" = `2`)
) %>%
select(-total)
print(v)
##### EXPLORE
## define a function to tabulate by gender year
tab_freq.yearsex <- function(d,v,ny) {
eval(substitute(v), d)
print(v)
tab <- d %>%
select(YEAR,v) %>%
group_by(YEAR,v) %>%
filter(v!=-8) %>%
count(v) %>%
mutate(
total=sum(.$n)
) %>%
spread(
.,"v",n
) %>%
rename(
., c("Male" = `1`,  "Female" = `2`)
) %>%
select(-total)
print(tab , n=ny)
}
## Frequencies by gender of the respondent
tab_freq.yearsex(df,"SEX",27)
## Frequencies by gender of the respondent
tab_freq.yearsex(df,SEX,27)
##### EXPLORE
## define a function to tabulate by gender year
tab_freq.yearsex <- function(d,v,ny) {
eval(substitute(v), d)
print(v)
tab <- d %>%
select(YEAR,v) %>%
group_by(YEAR,v) %>%
filter(v!=-8) %>%
count(v) %>%
mutate(
total=sum(.$n)
) %>%
spread(
.,"v",n
) %>%
rename(
., c("Male" = `1`,  "Female" = `2`)
) %>%
select(-total)
print(tab , n=ny)
}
## Frequencies by gender of the respondent
tab_freq.yearsex(df,SEX,27)
##### EXPLORE
## define a function to tabulate by gender year
tab_freq.yearsex <- function(d,v,ny) {
eval(substitute(v), d)
print("v")
tab <- d %>%
select(YEAR,v) %>%
group_by(YEAR,v) %>%
filter(v!=-8) %>%
count(v) %>%
mutate(
total=sum(.$n)
) %>%
spread(
.,"v",n
) %>%
rename(
., c("Male" = `1`,  "Female" = `2`)
) %>%
select(-total)
print(tab , n=ny)
}
## Frequencies by gender of the respondent
tab_freq.yearsex(df,SEX,27)
##### EXPLORE
## define a function to tabulate by gender year
tab_freq.yearsex <- function(d,v,ny) {
tab <- d %>%
select(YEAR,v) %>%
group_by(YEAR,v) %>%
filter(v!=-8) %>%
count(v) %>%
mutate(
total=sum(.$n)
) %>%
spread(
.,"v",n
) %>%
rename(
., c("Male" = `1`,  "Female" = `2`)
) %>%
select(-total)
print(tab , n=ny)
}
## Frequencies by gender of the respondent
tab_freq.yearsex(df,SEX,27)
##### EXPLORE
## define a function to tabulate by gender year
tab_freq.yearsex <- function(d,v,ny) {
tab <- d %>%
select(YEAR,[[v]]) %>%
## Frequencies by gender of the respondent
tab_freq.yearsex(df,SEX,27)
##### EXPLORE
## define a function to tabulate by gender year
tab_freq.yearsex <- function(d,v,ny) {
tab <- d %>%
select(YEAR,[[v]]) %>%
## Frequencies by gender of the respondent
tab_freq.yearsex(df,SEX,27)
table(df$YEAR)
transpose(table(df$YEAR))
##### EXPLORE
## define a function to tabulate by gender year
tab_freq.yearsex <- function(d,v,ny) {
print(d)
print(v)
print(ny)
tab <- d %>%
select(YEAR,v) %>%
group_by(YEAR,v) %>%
filter(v!=-8) %>%
count(v) %>%
mutate(
total=sum(.$n)
) %>%
spread(
.,"v",n
) %>%
rename(
., c("Male" = `1`,  "Female" = `2`)
) %>%
select(-total)
print(tab , n=ny)
}
## Frequencies by gender of the respondent
tab_freq.yearsex(df,SEX,27)
##### EXPLORE
## define a function to tabulate by gender year
tab_freq.yearsex <- function(d,v,ny) {
tab <- d %>%
select(YEAR,{{v}}) %>%
group_by(YEAR,{{v}}) %>%
filter({{v}}!=-8) %>%
count({{v}}) %>%
mutate(
total=sum(.$n)
) %>%
spread(
.,"v",n
) %>%
rename(
., c("Male" = `1`,  "Female" = `2`)
) %>%
select(-total)
print(tab , n=ny)
}
## Frequencies by gender of the respondent
tab_freq.yearsex(df,SEX,27)
##### EXPLORE
## define a function to tabulate by gender year
tab_freq.yearsex <- function(d,v,ny) {
tab <- d %>%
select(YEAR,{{v}}) %>%
group_by(YEAR,{{v}}) %>%
filter({{v}}!=-8) %>%
count({{v}}) %>%
mutate(
total=sum(.$n)
) %>%
spread(
.,{{v}},n
) %>%
rename(
., c("Male" = `1`,  "Female" = `2`)
) %>%
select(-total)
print(tab , n=ny)
}
## Frequencies by gender of the respondent
tab_freq.yearsex(df,SEX,27)
## Frequencies by gender of the respondent
tab_freq.yearsex(df,"SEX",27)
## Freq by marital status
tab_freq.yearsex(df,CIVSTAT,27)
##### EXPLORE
## define a function to tabulate by gender year
tab_freq.yearsex <- function(d,v,ny) {
tab <- d %>%
select(YEAR,{{v}}) %>%
group_by(YEAR,{{v}}) %>%
filter({{v}}!=-8) %>%
count({{v}}) %>%
mutate(
total=sum(.$n)
) %>%
spread(
.,{{v}},n
) %>%
select(-total)
print(tab , n=ny)
}
## Frequencies by gender of the respondent
tab_freq.yearsex(df,SEX,27)
## Freq by marital status
tab_freq.yearsex(df,CIVSTAT,27)
##### EXPLORE
## define a function to tabulate by gender year
tab_freq.year <- function(d,v,ny) {
tab <- d %>%
select(YEAR,{{v}}) %>%
group_by(YEAR,{{v}}) %>%
filter({{v}}!=-8) %>%
count({{v}}) %>%
mutate(
total=sum(.$n)
) %>%
spread(
.,{{v}},n
) %>%
select(-total)
print(tab , n=ny)
}
## Frequencies by gender of the respondent
tab_freq.yearsex(df,SEX,27)
## Freq by marital status
tab_freq.yearsex(df,CIVSTAT,27)
##### EXPLORE
## define a function to tabulate by gender year
tab_freq.year <- function(d,v,ny) {
tab <- d %>%
select(YEAR,{{v}}) %>%
group_by(YEAR,{{v}}) %>%
filter({{v}}!=-8) %>%
count({{v}}) %>%
mutate(
total=sum(.$n)
) %>%
spread(
.,{{v}},n
) %>%
#   rename(., c("Male" = `1`,  "Female" = `2`)) %>%
select(-total)
print(tab , n=ny)
}
## Frequencies by gender of the respondent
tab_freq.yearsex(df,SEX,27)
## Freq by marital status
tab_freq.yearsex(df,CIVSTAT,27)
##### EXPLORE
## define a function to tabulate by gender year
tab_freq.year <- function(d,v,ny) {
tab <- d %>%
select(YEAR,{{v}}) %>%
group_by(YEAR,{{v}}) %>%
filter({{v}}!=-8,{{v}}!=-9) %>%
count({{v}}) %>%
mutate(
total=sum(.$n)
) %>%
spread(
.,{{v}},n
) %>%
#   rename(., c("Male" = `1`,  "Female" = `2`)) %>%
select(-total)
print(tab , n=ny)
}
## Frequencies by gender of the respondent
tab_freq.yearsex(df,SEX,27)
## Freq by marital status
tab_freq.yearsex(df,CIVSTAT,27)
## Cohabiting or married
# 1 in couple, 2 not in couple
tab_freq.yearsex(df,COHAB,27)
## Employed
# -7 NA, 0 not employed, 1 in paid work
tab_freq.yearsex(df,EMP,27)
## ood quality data?
# 0 is good others have issues
tab_freq.yearsex(df,BADCASE,27)
df.raw <- read_ipums_micro(ddi)
## Drop the years before 2003, so we keep the consistent data sample
df <- df.raw %>% filter(.,YEAR<2003)
df
## Drop the years before 2003, so we keep the consistent data sample
df <- df.raw %>% filter(.,YEAR>=2003)
df
tab_freq.yearsex <- function(d,v,ny) {
tab <- d %>%
select(YEAR,SEX,{{v}}) %>%
group_by(YEAR,SEX,{{v}}) %>%
filter({{v}}!=-8,{{v}}!=-9) %>%
count({{v}}) %>%
mutate(
total=sum(.$n)
) %>%
spread(
.,{{v}},n
) %>%
#   rename(., c("Male" = `1`,  "Female" = `2`)) %>%
select(-total)
print(tab , n=ny)
}
## Frequencies by gender of the respondent
# 1 male, 2 female
tab_freq.year(df.raw,SEX,27)
## Freq by marital status
# 1 in couple, 2 not in couple
tab_freq.year(df.raw,CIVSTAT,27)
tab_freq.yearsex(df.raw,CIVSTAT,27)
tab_freq.yearsex <- function(d,v,ny) {
tab <- d %>%
select(YEAR,SEX,{{v}}) %>%
group_by(YEAR,SEX,{{v}}) %>%
filter({{v}}!=-8,{{v}}!=-9) %>%
count({{v}}) %>%
mutate(
total=sum(.$n)
) %>%
spread(
.,c=({{v}},SEX),n
tab_freq.yearsex <- function(d,v,ny) {
tab <- d %>%
select(YEAR,SEX,{{v}}) %>%
group_by(YEAR,SEX,{{v}}) %>%
filter({{v}}!=-8,{{v}}!=-9) %>%
count({{v}}) %>%
mutate(
total=sum(.$n)
) %>%
spread(
.,c=("{{v}}","SEX"),n
# SAMPLE DEFITIONS ------------------------------------------------------------
## Drop the years before 2003, so we keep the consistent data sample
df <- df.raw %>% filter(.,YEAR>=2003)
View(df)
df$PERSID[1]
print(df$PERSID[1])
table(df$DIARY)
table(df$COUNTRY)
table(df$COUNTRY)PARNTID1
table(df$PARNTID1)
table(df$PARTID)
table(df$PARTID,df$YEAR)
table(df$HLDID)
## What is this HLDID business
df <- df %>%
mutate(
hldid.zero=if(HLDID==0,1,0)
## What is this HLDID business
df <- df %>%
mutate(
hldid.zero=ifelse(HLDID==0,1,0)
)
table(df$HLDID)
table(df$hldid.zero)
table(df$YEAR,df$hldid.zero)
## Check out the post 2013 years
df.post13 <- df %>% filter(.,YEAR>=2013)
View(df.post13)
df.post13$check <- format(df.post13$HLDID, scientific=FALSE)
# check a diary from one hh
df.check <- filter(HLDID==20130101131050)
# check a diary from one hh
df.check <- df %>% filter(HLDID==20130101131050)
View(df.check)
format(df.post13$PERSID, scientific=FALSE)
format(df.check$PERSID, scientific=FALSE)
rm(df.check)
# check a diary from one hh
df.check <- df %>% filter(HLDID==20130101131190)
format(df.check$PERSID, scientific=FALSE)
View(df.check)
## It seems like only in the years post 2013 die more than 1 hh member complete
#   the diary, so maybe we try to recompose households only then?
df <- df %>%
mutate(
hldid.zero=ifelse(HLDID==0,1,0)
)
table(df$YEAR,df$hldid.zero)
## Check out the post 2013 years
df.post13 <- df %>% filter(.,YEAR>=2013)
# format hh and person ID's to see if its the same
df.post13$PERSID <- format(df.check$PERSID, scientific=FALSE)
# format hh and person ID's to see if its the same
df.post13$PERSID <- format(df.post13$PERSID, scientific=FALSE)
df.post13$HLDID <- format(df.post13$HLDID, scientific=FALSE)
View(df.post13)
# get an indicator for there being more than one person from the hh
df.post13$PERSID_num <- df.post13 %>%
select(PERSID) %>%
group_by(PERSID) %>%
mutate(
total=sum(.$n)
)
# get an indicator for there being more than one person from the hh
df.post13 <- df.post13 %>%
group_by(HLDID) %>%
mutate(
HLDID_num=count(HLDID)
)
# get an indicator for there being more than one person from the hh
df.post13 <- df.post13 %>%
group_by(HLDID) %>%
count(HLDID)
View(df.post13)
# get an indicator for there being more than one person from the hh
df.post13$HLDID_num <- df.post13 %>%
group_by(HLDID) %>%
count(HLDID)
## It seems like only in the years post 2013 die more than 1 hh member complete
#   the diary, so maybe we try to recompose households only then?
df <- df %>%
mutate(
hldid.zero=ifelse(HLDID==0,1,0)
)
table(df$YEAR,df$hldid.zero)
## Check out the post 2013 years
df.post13 <- df %>% filter(.,YEAR>=2013)
# format hh and person ID's
df.post13$PERSID <- format(df.post13$PERSID, scientific=FALSE)
df.post13$HLDID <- format(df.post13$HLDID, scientific=FALSE)
# get an indicator for there being more than one person from the hh
df.post13$HLDID_num <- df.post13 %>%
group_by(HLDID) %>%
count(HLDID)
View(df.post13)
# get an indicator for there being more than one person from the hh
df.post13$HLDID_num <- df.post13 %>%
group_by(HLDID) %>%
count(HLDID) %>%
select(n)
# get an indicator for there being more than one person from the hh
df.post13$HLDID_num <- df.post13 %>%
group_by(HLDID) %>%
count(HLDID) %>%
select(.$n)
# get an indicator for there being more than one person from the hh
df.post13$HLDID_num <- df.post13 %>%
group_by(HLDID) %>%
mutate(
HLDID_num = count(HLDID)
) %>%
ungroup()
# get an indicator for there being more than one person from the hh
df.post13$HLDID_num <- df.post13 %>%
group_by(HLDID) %>%
mutate(
HLDID_num = n(HLDID)
) %>%
ungroup()
# get an indicator for there being more than one person from the hh
df.post13 <- df.post13 %>%
group_by(HLDID) %>%
mutate(
HLDID_num = n(HLDID)
) %>%
ungroup()
## Check out the post 2013 years
df.post13 <- df %>% filter(.,YEAR>=2013)
# format hh and person ID's
df.post13$PERSID <- format(df.post13$PERSID, scientific=FALSE)
df.post13$HLDID <- format(df.post13$HLDID, scientific=FALSE)
# get an indicator for there being more than one person from the hh
df.post13 <- df.post13 %>%
group_by(HLDID) %>%
mutate(
HLDID_num = n(HLDID)
)
# get an indicator for there being more than one person from the hh
df.post13 <- df.post13 %>%
group_by(HLDID) %>%
mutate(
HLDID_num = n()
) %>%
ungroup()
